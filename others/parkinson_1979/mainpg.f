      SUBROUTINE MAINPG(IHEMI,IT,JT,NYMIN,NYTAPE,NYMAX)
C
      IMPLICIT none

      INTEGER IHEMI, IT, JT, NYMIN, NYTAPE, NYMAX

C     DECLARE BLANK COMMON
      REAL SEALND(42,41), TSNOW(42,31), HICE(42,31), HSNO(42,31)
      REAL FREE(42,31),FXSOL(42,31),TOCN(42,31),FXBTM(42,31),TICE(42,31) 
      REAL TEMPM(42,31,12),DEWM(42,31,12),UMAT(42,31,12),VMAT(42,31,12)

C     DECLARE COMMONS C1-C5
      REAL TEMP, FLON, DEW, VP, CLDD, DRAGW
      REAL AREA, AMIN, DT, DMIX, EYN, QS, QI, SIGMA, SK, TB, YK
      REAL FSEN, FSENW, FMI, DAY, SNO(12)
      REAL TS, TI, HI, HS, TW, WIND, TWI, FLAT, DRAG, FLATW, FLONW
      REAL DTOP(42,41)

C     DECLARE COMMON C6
      REAL RLAT, RLONG, DLAT, DLONG
      INTEGER NSTEP
      REAL COSZ, STIME, TIME, TSFLUX, XLAT(42,31), XLON(42,31)

C     DECLARE COMMON C7-C10
      INTEGER NCC, NCB
      REAL UICE(42,31), VICE(42,31), STEP
      REAL AIRD, Q10M, QSURF

      COMMON SEALND,TSNOW,HICE,HSNO,
     1FREE,FXSOL,TOCN,FXBTM,TICE,
     2TEMPM,DEWM,UMAT,VMAT
      COMMON /C1/ TEMP,FLON,DEW,VP,CLDD,DRAGW
      COMMON /C2/ AREA,AMIN,DT,DMIX,EYN,QS,QI,SIGMA,SK,TB,YK
      COMMON /C3/ FSEN,FSENW,FMI,DAY,SNO
      COMMON /C4/ TS,TI,HI,HS,TW,WIND,TWI,FLAT,DRAG,FLATW,FLONW
      COMMON /C5/ DTOP
      COMMON /C6/ RLAT,RLONG,DLAT,DLONG,NSTEP,
     1COSZ,STIME,TIME,TSFLUX,XLAT,XLON
      COMMON /C7/ NCC,NCB
      COMMON /C8/ UICE,VICE,STEP
      COMMON /C9/ AIRD
      COMMON /C10/ Q10M,QSURF

      REAL TWUI(42,31),CLD(12)
      REAL CL1, CL2, CL3, CL4, CL5, CL6, CL7, CL8, CL9, CL10
      REAL EMI, EMS, EMW, ASTART, DEG, AI, AS, AW
      REAL EMUU, AU
      REAL UWIND, VWIND, DL1, DL2, DL3, DL4 
      REAL XANC, XULYC
      REAL A1, A2, A3, A4, A5, A6, A7, A8, A9

      INTEGER I, J, M, LEN
      INTEGER NN, NY, M7, M13, N, NZ, MZ, JJ
      INTEGER M1, M2, J1

C     Call msetup.  For now, only drop the array reads from here.
      CALL msetup(IHEMI, IT, JT, NYMIN, NYTAPE, NYMAX,
     1 CL1, CL2, CL3, CL4, CL5, CL6, CL7, CL8, CL9, CL10,
     2 CLD, EMI, EMS, EMW, ASTART, DEG, AI, AS, AW, NN, TWUI)

C
C INITIALIZE LAND GRID PT VALUES
C
C  PERFORM CALCULATIONS, LOOPING THROUGH EACH TIME STEP OF EACH
C    MONTH OF EACH YEAR
C
      DO 900 NY=NYMIN,NYMAX
      DO 850 M=1,12
C
      PRINT 5,NY,M
    5 FORMAT (///1X,'BEGINNING YEAR',I3,', MONTH',I3)
      M7=7-M
      M13=M-1
      IF(M.LE.7) GO TO 52
      M7=M-7
      M13=13-M
   52 CONTINUE
      CLDD=CLD(M)
      DO 800 N=1,NSTEP
      DAY=30.*FLOAT(N)/FLOAT(NSTEP)
      NCB=0
      NZ=N+90*(M-1)
      NZ=MOD(NZ,11)
      IF (N.EQ.45) NCB=1
      IF (N.LE.45) STEP=(N+NN-1.)/FLOAT(NSTEP)
      IF (N.GE.46) STEP=(N-NN+1.)/FLOAT(NSTEP)
      M2=M
      IF (N.GE.46) M2=M+1
      M1=M2-1
      IF (M2.EQ.13) M2=1
      IF (M1.EQ.0) M1=12
C SWEEP GRIDPTS FOR THIS TIMESTEP
      DO 3005 J=1,JT
      DO 3005 I=1,IT
      NCC=0
      IF(IHEMI.EQ.2) GO TO 308
      IF (I.EQ.19.AND.J.EQ.16) NCC=NCB+1
      IF (I.EQ.20.AND.J.EQ.18) NCC=NCB+1
      GO TO 309
  308 CONTINUE
      IF (I.EQ.32.AND.J.EQ.26) NCC=NCB+1
      IF (I.EQ.32.AND.J.EQ.27) NCC=NCB+1
  309 CONTINUE
C JUMP TO END OF LOOP FOR LAND PTS
      IF (SEALND(I,J) .LE. 0.5) GO TO 3005
      RLAT=XLAT(I,J)
      DLAT=RLAT*DEG
C SET UNDIMENSIONED VARIABLES TO GRID PT VALUE  IN PREPARATION FOR THERM
      TS=TSNOW(I,J)
      TI=TICE(I,J)
      HI=HICE(I,J)
      HS=HSNO(I,J)
      AREA=FREE(I,J)
      TW=TOCN(I,J)
      TWI=TWUI(I,J)
      TEMP=(TEMPM(I,J,M2)-TEMPM(I,J,M1))*STEP+TEMPM(I,J,M1)
      DEW=(DEWM(I,J,M2)-DEWM(I,J,M1))*STEP+DEWM(I,J,M1)
      UWIND=(UMAT(I,J,M2)-UMAT(I,J,M1))*STEP+UMAT(I,J,M1)
      VWIND=(VMAT(I,J,M2)-VMAT(I,J,M1))*STEP+VMAT(I,J,M1)
      WIND=SQRT(UWIND*UWIND+VWIND*VWIND)
      AIRD=(353.31-9.06*(IHEMI-1))/TEMP
      IF(IHEMI.EQ.1) GO TO 24
C CALCULATE SET CLOUD AMOUNT
      DL1=-DLAT
      DL2=DL1*DL1
      DL3=DL2*DL1
      DL4=DL3*DL1
      XANC=CL1*DL4-CL2*DL3+CL3*DL2-CL4*DL1+CL5
      XULYC=CL6*DL4-CL7*DL3+CL8*DL2-CL9*DL1+CL10
      CLDD=(M7*XANC+M13*XULYC)/6.0
   24 CONTINUE
C COMPUTE LONG WAVE AND LATENT HEAT FLUXES
C  OUTPUTS OF FILONG ARE VALUES FOR FLON, FLAT, FLONW, FLATW
      CALL FILONG(M,IHEMI)
C  COMPUTE SOLAR FLUX ONCE EVERY 3+DAYS, I.E. ONCE EVERY 11 TIMESTEPS
C   OUTPUT OF CALLING SOLARF IS VALUE FOR TSFLUX
      TSFLUX=FXSOL(I,J)
      DLONG=XLON(I,J)* DEG
      IF(NZ.NE.1)GOTO74
      CALL SOLARF(M,N,IT,JT)
   74 CONTINUE
C  COMPUTE SENSIBLE HEAT FLUX
      FSEN =AIRD*1004.0*DRAG *WIND*(TEMP-TS)
      FSENW=AIRD*1004.0*DRAGW*WIND*(TEMP-TW)
C     Compute radiative heating
      IF (NCC.NE.2) GO TO 60
      IF(IHEMI.EQ.2) GO TO 60
      AU=AI
      EMUU=EMI
      IF (HS.EQ.0.0) GO TO 62
      AU=AS
      EMUU=EMS
   62 A1=FLON*EMUU
      A2=TSFLUX*(1.0-AU)
      A3=FLONW*EMW
      A4=TSFLUX*(1.0-AW)
      A5=FSEN*(1.0-AREA)+FSENW*AREA
      A6=FLAT*(1.0-AREA)+FLATW*AREA
      A7=FLON*(1.0-AREA)+FLONW*AREA
      A8=A1*(1.0-AREA)+A3*AREA
      A9=A2*(1.0-AREA)+A4*AREA
      PRINT 61, NY,M,N,I,J,FSEN,FLAT,FLON,A1,TSFLUX,A2,
     1 FSENW, FLATW,FLONW,A3,TSFLUX,A4,                  A5,A6,A7,A8,
     2 TSFLUX,A9,                   WIND, TEMP,TS,TW,CLDD,AREA
     3,DLAT,DLONG
   61 FORMAT (1X,'YEAR',I3,', MONTH',I3, ', TIMESTEP',I3, '     DATA FOR
     2 POINT I=',I3,'J=',I3/14X,'         H            LE            LWD
     3          EM LWD          SWD          SWNET'
     4          /4X,'OVER ICE  ',6F14.4/4X,'OVER WATER',6F14.4/
     5 4X,'WEIGHTED  ',6F14.4       /4X,'WIND =',F9.5,', TEMP =',F9.4,
     6 ', TS =',F9.4 ,     ', TW =',F9.4,',CLOUD =', F7.4,', LEAD AREA =
     7',F7.4,', LAT,LONG=',2F9.4)
      PRINT 584,I,J,AIRD,WIND,TEMP,TS,TW,Q10M,QSURF,HI
  584 FORMAT (1X,2I3,'AIR DENSITY =',F7.3,' WIND =',F8.4,3F9.4,3F10.5)
   60 CONTINUE
C COMPUTE VALUES FOR DEPTH AND TEMPERATURE OF SNOW AND ICE
C
      CALL THERMO (NY,M,N,I,J,IT,JT,IHEMI)
C
C PRESERVE VARIABLE VALUES FOR GRID POINT
      TSNOW(I,J)=TS
      TICE(I,J)=TI
      HICE(I,J)=HI
      HSNO(I,J)=HS
      FREE(I,J)=AREA
      TOCN(I,J)=TW
      TWUI(I,J)=TWI
      FXSOL(I,J)=TSFLUX
CBG      FXBTM(I,J)=FB
        FXBTM(I,J) = 2.0
3005  CONTINUE
      MZ=MOD(N,5)
      IF (MZ.EQ.0) CALL DNAMIC (N,M,NY,IT,JT,IHEMI)
      IF (N.NE.45) GO TO 800
      IF(IHEMI.EQ.2) GO TO 43
      IF(IHEMI.EQ.1) GO TO 400
C
C
      PRINT 995
      PRINT 998
      DO 980 J=1,31
      JJ=32-J
      PRINT 989,JJ,(UICE(I,JJ),I=1,9)
  980 CONTINUE
      PRINT 995
      DO 981 J=1,31
      JJ=32-J
      PRINT 989,JJ,(UICE(I,JJ),I=10,18)
  981 CONTINUE
      PRINT 995
      DO 982 J=1,31
      JJ=32-J
      PRINT 989,JJ,(UICE(I,JJ),I=19,27)
  982 CONTINUE
      PRINT 995
      DO 983 J=1,31
      JJ=32-J
      PRINT 989,JJ,(UICE(I,JJ),I=28,36)
  983 CONTINUE
      PRINT 995
      DO 984 J=1,31
      JJ=32-J
      PRINT 989,JJ,(UICE(I,JJ),I=37,42)
  984 CONTINUE
C
      PRINT 995
      PRINT 994
      DO 985 J=1,31
      JJ=32-J
      PRINT 989,JJ,(VICE(I,JJ),I=1,9)
  985 CONTINUE
      PRINT 995
      DO 986 J=1,31
      JJ=32-J
      PRINT 989,JJ,(VICE(I,JJ),I=10,18)
  986 CONTINUE
      PRINT 995
      DO 987 J=1,31
      JJ=32-J
      PRINT 989,JJ,(VICE(I,JJ),I=19,27)
  987 CONTINUE
      PRINT 995
      DO 988 J=1,31
      JJ=32-J
      PRINT 989,JJ,(VICE(I,JJ),I=28,36)
  988 CONTINUE
      PRINT 995
      DO 979 J=1,31
      JJ=32-J
      PRINT 989,JJ,(VICE(I,JJ),I=37,42)
  979 CONTINUE
C
      PRINT 995
  989 FORMAT(1X,I2,2X,9(E12.4,1X))
  998 FORMAT(1X,'VALUES FOR UICE(I,J)',//)
  994 FORMAT(1X,'VALUES FOR VICE(I,J)',//)
  995 FORMAT(1X///)
  400 CONTINUE
C
C
      PRINT 42, HICE(7,4),HSNO(7,4),FREE(7,4),UICE(7,4),VICE(7,4)
     3,HICE(7,29),HSNO(7,29),FREE(7,29),UICE(7,29),VICE(7,29),
     3 HICE(26,16),HSNO(26,16),FREE(26,16),UICE(26,16),VICE(26,16),
     4 HICE(22,14),HSNO(22,14),FREE(22,14),UICE(22,14),VICE(22,14)
   42 FORMAT (/1X,'POINT (7,4) HAS HICE,HSNO,FREE,UICE,VICE =',5F10.6/
     2 1X,                             'POINT (7,29) HAS',5F10.6/
     2 1X,'POINT 26,16  HAS',5F10.6/1X,'POINT 22,14  HAS',5F10.6)
      PRINT 782, (FREE(26,J1),J1=15,29)
  782 FORMAT (1X,'FREE (26,J) = ',15F6.4)
      GO TO 44
   43 CONTINUE
      PRINT 41, HICE(32,26),HSNO(32,26),FREE(32,26),UICE(32,26),
     2VICE(32,26),HICE(32,27),HSNO(32,27),FREE(32,27),UICE(32,27),
     4VICE(32,27),HICE(34,21),HSNO(34,21),FREE(34,21),UICE(34,21),
     5 VICE(34,21)
   41 FORMAT(/1X,'POINT (32,26) HAS HICE,HSNO,FREE,UICE,VICE ',5F10.6/
     2 1X,'POINT (32,27) HAS',5F10.6/1X,'POINT (34,21) HAS',5F10.6)
   44 CONTINUE
      DO 56 JJ=1,JT
      J=JT+1-JJ
      PRINT 57,J,(HICE(I,J),I=1,23)
   57 FORMAT (1X,I2,1X,23F5.2)
   56 CONTINUE
      DO 58 JJ=1,JT
      J=JT+1-JJ
      PRINT 59,J,(HICE(I,J),I=24,IT)
   59 FORMAT (5X,I2,1X,19F5.2,'HICE')
   58 CONTINUE
  800 CONTINUE
C
 850  CONTINUE
 900  CONTINUE
C
      IF(NYTAPE.GT.NYMAX) GO TO 104
      LEN=5208+1516*(IHEMI-1)
      CALL FWRITE(HICE,4,LEN)
      CALL FWRITE(HSNO,4,LEN)
      CALL FWRITE(FREE,4,LEN)
      CALL FWRITE(TOCN,4,LEN)
      CALL FWRITE(TWUI,4,LEN)
      CALL FWRITE(FXSOL,4,LEN)
      CALL FWRITE(FXBTM,4,LEN)
      CALL FWRITE(TSNOW,4,LEN)
      CALL FWRITE(TICE,4,LEN)
  104 CONTINUE
       STOP
 105   WRITE(6,9899)
9899   FORMAT(' END OF FILE ENCOUNTERED')
       STOP
 106   WRITE(6,9999)
9999   FORMAT(' I/O ERROR ON TAPE')
      RETURN
      END
