C     THIS PROGRAM IS DESIGNED TO DUPLICATE THE PROGRAM USED IN
C       KILLWORTH'S 1974 PAPER, WITH THE CAPABILITY TO GENERALIZE
C       THE MODEL.

      INTEGER XMAX, YMAX
      PARAMETER ( XMAX = 20 )
      PARAMETER ( YMAX = 18 )

C*************************************************----------++++++++++!!

C     COMMON BLOCK /MAIN/ CONTAINS THE ARRAYS WHICH HOLD THE PHYSICAL
C       VARIABLES OF INTEREST. U IS THE EASTWARD VELOCITY,
C       V IS THE NORTHWARD VELOCITY, T = RHO1+ RHO2, S=RHO1 - RHO2,
C       WHERE RHO1 IS THE DENSITY OF THE UPPER LAYER, AND RHO2 IS THE
C       DENSITY OF THE LOWER LAYER.
C       Q IS RELATED TO THE FREEZING RATE OF ICE.

      REAL U(0:XMAX+1, 0:YMAX), V(0:XMAX+1, 0:YMAX),
     1     S(0:XMAX+1, 0:YMAX), T(0:XMAX+1, 0:YMAX),
     2     Q(0:XMAX+1, 0:YMAX)


C     COMMON /PARAMS/ HAS THE VARIOUS PARAMETERS THAT CONTROL THE
C       EXECUTION OF THE PROGRAM, AND THE VARIOUS PHYSICAL CONSTANTS.
C     DELTAT IS THE TIME STEP, DELTAX IS THE GRID SPACING (SAME IN
C       BOTH THE X AND Y DIRECTIONS), E IS AS DEFINED IN THE PAPER,
C       R IS A ROSSBY NUMBER (DEFINED IN THE PAPER), EPSILON IS
C       RELATED TO THE DIFFUSION OF SALINITY, SIGMA, XBOX IS THE
C       VALUE OF THE RIGHT-HAND SIDE OF THE WEDDELL SEA, YCOAST
C       IS THE Y COORDINATE OF THE COAST OUTSIDE THE BAY, TEND IS
C       THE END TIME OF THE EXTRAPOLATION IN YEARS.

      COMMON /PARAMS/ DELTAT, DELTAX, E, R, EPSILN, SIGMA,
     1                XBOX, YCOAST, TEND, DEBUG, OUTDEN

      REAL DELTAT, DELTAX, E, R, EPSILN, SIGMA, TEND
      INTEGER XBOX, YCOAST, OUTDEN
      LOGICAL DEBUG

C     LOCAL VARIABLES
      INTEGER TSTEP

CH    VARIABLES FOR TIMING INFORMATION.
CH    INTEGER CLOCK, TEMP
CH    INTEGER UVSTIM, UVTIM, STTIM, QTIM, OUTTIM

C*************************************************----------++++++++++!!
C     NOW BEGIN THE ACTUAL EXECUTION OF THE PROGRAM.
C     INIT INITIALIZES U, V, S, T, AND /PARAMS/.
C     OUTSET  INITIALIZES THE I/O.
C     UVSET INITIALIZES THE EXTRAPOLATION FOR U AND V.
C     QSET INITIALIZES THE EXTRAPOLATION OF Q, READS IN SOME PARAM-
C          ETERS USED LOCALLY TO THE ROUTINE.
C     CALL OUTDAT WRITES OUT THE INITIAL CONDITIONS.

CH    INITIALIZE THE TIMING VARIABLES.
CH    UVSTIM = 0
CH    UVTIM  = 0
CH    STTIM  = 0
CH    QTIM   = 0
CH    OUTTIM = 0

      TSTEP = 0

      CALL OUTSET(XMAX, YMAX, U, V, S, T, Q, TSTEP)
      CALL INIT(XMAX, YMAX, U, V, S, T)
CH    TEMP = CLOCK(0)
      CALL UVSET( U, V, S, T)
CH    PRINT *, 'TIME SPENT IN INITIALIZING UV =',(CLOCK(0)-TEMP)/1.E6
      CALL QSET   ( XMAX, YMAX, Q, TSTEP, DELTAT )
      CALL OUTDAT ( XMAX, YMAX, U, V, S, T, Q, 0 )

C     THIS IS THE ACTUAL EXTRAPOLATION LOOP.
C     UVEXT EXTRAPOLATES U AND V TO THE NEXT TIME STEP.
C     STEXT EXTRAPOLATES S AND T TO THE NEXT TIME STEP.
C     QEXT  EVALUATES Q FOR THE NEXT TIME STEP.
C     OUTDAT PRINTS OUT W (UPWELLING VELOCITY), RHO1 (DENSITY OF THE
C            UPPER LAYER), AND RHO2 (DENSITY OF THE LOWER LAYER).

C*************************************************----------++++++++++!!
      DO 1000 TSTEP = 1, INT( TEND/ DELTAT)

CH      TEMP = CLOCK(0)
        CALL UVEXT( U, V, S, T)
C       IF (DEBUG) WRITE (*,9001) TSTEP
CH      UVTIM = UVTIM + CLOCK(0) - TEMP
CH      TEMP = CLOCK(0)
        CALL STEXT(XMAX, YMAX, U, V, S, T, Q, TSTEP)
C       IF (DEBUG) WRITE (*,9002) TSTEP
CH      STTIM = STTIM + CLOCK (0) - TEMP

CH      TEMP = CLOCK(0)
        CALL QEXT(XMAX, YMAX, Q, TSTEP, DELTAT)
C       IF (DEBUG) WRITE (*,9003) TSTEP
CH      QTIM = QTIM + CLOCK (0) - TEMP

CH      TEMP = CLOCK(0)
        IF (MOD( TSTEP, OUTDEN) .EQ. 0)
     1      CALL OUTDAT(XMAX, YMAX, U, V, S, T, Q, TSTEP)
CH      OUTTIM = OUTTIM + CLOCK (0) - TEMP

 1000 CONTINUE

CH    PRINT *,'TIME SPENT IN U-V EXTRAPOLATION:', UVTIM/1.E6

CH    PRINT *,'TIME SPENT IN S-T EXTRAPOLATION:', STTIM/1.E6

CH    PRINT *,'TIME SPENT IN Q EXTRAPOLATION:  ', QTIM/1.E6

CH    PRINT *,'TIME SPENT ON OUTPUT:           ', OUTTIM/1.E6
C     OUTEND CLOSES ALL THE FILES AND DOES ANY CLEAN UP THAT IS NEEDED.
      CALL OUTEND(XMAX, YMAX, U, V, S, T, Q, TSTEP)

CH 9001 FORMAT (' FINISHED UVEXT, TSTEP=',I6)

CH 9002 FORMAT (' FINISHED STEXT, TSTEP=',I6)

CH 9003 FORMAT (' FINISHED QEXT, TSTEP=',I6)

      END
